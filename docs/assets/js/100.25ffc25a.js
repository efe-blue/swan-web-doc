(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{300:function(t,_,v){"use strict";v.r(_);var r=v(28),e=Object(r.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h3",{attrs:{id:"使用场景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[t._v("#")]),t._v(" 使用场景")]),t._v(" "),v("p",[t._v("业务方智能小程序跳转至百度收银台，输入正确的交易密码之后，即订单支付成功后，百度收银台会主动调用业务方的的支付回调地址（开发者平台注册的支付回调地址）通知业务方该订单支付成功。")]),t._v(" "),v("h3",{attrs:{id:"接口注意事项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#接口注意事项"}},[t._v("#")]),t._v(" 接口注意事项")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("幂等性：业务方接口需要具备幂等性"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_2_base/anchor/term.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("平台技术术语---幂等性"),v("OutboundLink")],1),t._v("；")])]),t._v(" "),v("li",[v("p",[t._v("超时时间：业务方接口的耗时要求小于2s（超过2s会触发平台的超时重试，每2分钟/次，共计200次，回调失败订单会保持“已付款”状态，无法核销，导致订单金额无法顺利进入企业资产）；")])]),t._v(" "),v("li",[v("p",[t._v("返回值判断：errno为0表示商户已经成功收到支付信息，并妥善处理，errno不为0将认为是同步支付信息失败，当同步支付信息失败时，平台会发起重试，每2分钟/次，共计200次，订单会锁定“已付款”状态，无法核销，导致订单金额无法顺利进入企业资产；")])]),t._v(" "),v("li",[v("p",[t._v("回调地址服务器部署：如果回调接口部署在阿里云或有网关准入限制，请参考文档"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_1_guide/aliyun_v2.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云安全组设置"),v("OutboundLink")],1),t._v("中的IP地址设置白名单。"),v("br")])])]),t._v(" "),v("blockquote",[v("ul",[v("li",[t._v("回调地址配置后要确认服务审核是“审核通过”状态，审核中会导致无法收到回调地址,详见"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_4_rule/appauditrule_v2.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务审核注意事项"),v("OutboundLink")],1),t._v("。")]),t._v(" "),v("li",[t._v("服务器调用开发者回调接口不成功或开发者返回参数有误，平台会发起重试，每2分钟/次，共计200次，如重试后仍旧无法回调，订单会锁定“已付款”状态，无法核销，导致订单金额无法顺利进入企业资产。还请开发者仔细根据文档操作。如有无法核销的“已付款订单，请开发者提供appId、orderId、服务名称、公司名称、问题描述发送至问题反馈邮箱:jiaoyi-ask@baidu.com")])])]),t._v(" "),v("h4",{attrs:{id:"通知参数说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#通知参数说明"}},[t._v("#")]),t._v(" 通知参数说明")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("参数名称")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("说明")]),t._v(" "),v("th",[t._v("示例")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("userId")]),t._v(" "),v("td",[t._v("用户ID")]),t._v(" "),v("td",[t._v("Long")]),t._v(" "),v("td",[t._v("百度用户ID")]),t._v(" "),v("td",[t._v("149235070")])]),t._v(" "),v("tr",[v("td",[t._v("orderId")]),t._v(" "),v("td",[t._v("订单ID")]),t._v(" "),v("td",[t._v("Long")]),t._v(" "),v("td",[t._v("百度平台订单ID【"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_2_base/anchor/term.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("幂等性"),v("OutboundLink")],1),t._v("标识参数】(用于重入判断)")]),t._v(" "),v("td",[t._v("800020199")])]),t._v(" "),v("tr",[v("td",[t._v("unitPrice")]),t._v(" "),v("td",[t._v("单价")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("单位：分")]),t._v(" "),v("td",[t._v("800")])]),t._v(" "),v("tr",[v("td",[t._v("count")]),t._v(" "),v("td",[t._v("数量")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("数量")]),t._v(" "),v("td",[t._v("2")])]),t._v(" "),v("tr",[v("td",[t._v("totalMoney")]),t._v(" "),v("td",[t._v("总金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("订单的实际金额，单位：分")]),t._v(" "),v("td",[t._v("1600")])]),t._v(" "),v("tr",[v("td",[t._v("payMoney")]),t._v(" "),v("td",[t._v("实付金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("扣除各种优惠后用户还需要支付的金额，单位：分")]),t._v(" "),v("td",[t._v("1200")])]),t._v(" "),v("tr",[v("td",[t._v("promoMoney")]),t._v(" "),v("td",[t._v("营销金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("营销优惠金额")]),t._v(" "),v("td",[t._v("100")])]),t._v(" "),v("tr",[v("td",[t._v("hbMoney")]),t._v(" "),v("td",[t._v("红包支付金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("红包支付金额")]),t._v(" "),v("td",[t._v("100")])]),t._v(" "),v("tr",[v("td",[t._v("hbBalanceMoney")]),t._v(" "),v("td",[t._v("余额支付金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("余额支付金额")]),t._v(" "),v("td",[t._v("100")])]),t._v(" "),v("tr",[v("td",[t._v("giftCardMoney")]),t._v(" "),v("td",[t._v("抵用券金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("抵用券金额")]),t._v(" "),v("td",[t._v("100")])]),t._v(" "),v("tr",[v("td",[t._v("dealId")]),t._v(" "),v("td",[t._v("百度收银台凭证")]),t._v(" "),v("td",[t._v("Long")]),t._v(" "),v("td",[t._v("百度收银台的财务结算凭证")]),t._v(" "),v("td",[t._v("7423328")])]),t._v(" "),v("tr",[v("td",[t._v("payTime")]),t._v(" "),v("td",[t._v("支付时间")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("支付完成时间，时间戳")]),t._v(" "),v("td",[t._v("1463037529")])]),t._v(" "),v("tr",[v("td",[t._v("promoDetail")]),t._v(" "),v("td",[t._v("促销详情")]),t._v(" "),v("td",[t._v("Object")]),t._v(" "),v("td",[t._v("订单参与的促销优惠的详细信息")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("payType")]),t._v(" "),v("td",[t._v("支付渠道")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("支付渠道值")]),t._v(" "),v("td",[t._v("9101")])]),t._v(" "),v("tr",[v("td",[t._v("partnerId")]),t._v(" "),v("td",[t._v("支付平台")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("支付平台标识值")]),t._v(" "),v("td",[t._v("1000000003")])]),t._v(" "),v("tr",[v("td",[t._v("status")]),t._v(" "),v("td",[t._v("订单支付状态")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("1：未支付；2：已支付；-1：订单取消")]),t._v(" "),v("td",[t._v("2")])]),t._v(" "),v("tr",[v("td",[t._v("tpOrderId")]),t._v(" "),v("td",[t._v("业务方订单号")]),t._v(" "),v("td",[t._v("String")]),t._v(" "),v("td",[t._v("业务方唯一订单号")]),t._v(" "),v("td",[t._v("33330020199")])]),t._v(" "),v("tr",[v("td",[t._v("returnData")]),t._v(" "),v("td",[t._v("业务方透传数据")]),t._v(" "),v("td",[t._v("Object")]),t._v(" "),v("td",[t._v("业务方下单时传入的数据")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("rsaSign")]),t._v(" "),v("td",[t._v("rsa签名")]),t._v(" "),v("td",[t._v("String")]),t._v(" "),v("td",[t._v("rsa签名字符串")]),t._v(" "),v("td",[t._v("全部参数参与签名，详见"),v("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/function/sign_v2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名与验签"),v("OutboundLink")],1)])])])])]),t._v(" "),v("blockquote",[v("p",[t._v("这里对全部参数签名是对收到的平台回调的所有POST参数进行签名（这里所指的参数不包含rsasign，故不需要参与签名），空值参数同样需要参与签名，建议格式：key=&key2=value2，如没有对回调中收到的所有参数签名，会导致验签不通过，如果商户URL里包含GET类型参数，不会参与签名。注意：验签需要使用正确的平台公钥，可以在服务详情中查询，详见"),v("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/function/sign_v2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名与验签"),v("OutboundLink")],1),t._v("第8项内容。")])]),t._v(" "),v("h4",{attrs:{id:"返回参数说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#返回参数说明"}},[t._v("#")]),t._v(" 返回参数说明")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("名称")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("是否必须")]),t._v(" "),v("th",[t._v("示例值")]),t._v(" "),v("th",[t._v("描述")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("errno")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("0")]),t._v(" "),v("td",[t._v("返回码")])]),t._v(" "),v("tr",[v("td",[t._v("msg")]),t._v(" "),v("td",[t._v("String")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("success")]),t._v(" "),v("td",[t._v("返回信息")])]),t._v(" "),v("tr",[v("td",[t._v("data")]),t._v(" "),v("td",[t._v("Object")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v('{"isConsumed":0}')]),t._v(" "),v("td",[t._v("返回数据")])])])])]),t._v(" "),v("br"),t._v(" "),v("p",[t._v("data字段为JSON格式，参数如下：")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("名称")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("是否必须")]),t._v(" "),v("th",[t._v("示例值")]),t._v(" "),v("th",[t._v("描述")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("isConsumed")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("2")]),t._v(" "),v("td",[t._v("是否标记核销")])]),t._v(" "),v("tr",[v("td",[t._v("isErrorOrder")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("否")]),t._v(" "),v("td",[t._v("1")]),t._v(" "),v("td",[t._v("是否异常订单（如需主动发起异常退款，需将此字段设置为1）")])])])])]),t._v(" "),v("br"),t._v(" "),v("p",[t._v("isConsumed字段参数枚举值如下：")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("取值")]),t._v(" "),v("th",[t._v("描述")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("未消费")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("已消费")])])])])]),t._v(" "),v("br"),t._v(" "),v("h4",{attrs:{id:"isconsumed重要性：-为必传参数（不传会触发异常退款），用来标记该订单是否已消费。"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#isconsumed重要性：-为必传参数（不传会触发异常退款），用来标记该订单是否已消费。"}},[t._v("#")]),t._v(" "),v("strong",[t._v("isConsumed重要性：")]),t._v(" 为必传参数（不传会触发异常退款），用来标记该订单是否已消费。")]),t._v(" "),v("blockquote",[v("p",[t._v("小程序接入为支付成功即消费场景，该字段需设置为2。（字段不设置为2订单不会变更为“已消费”）如isConsumed值不返回2，“已付款”状态的订单金额不能顺利进入企业余额。")])]),t._v(" "),v("h4",{attrs:{id:"通知触发条件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#通知触发条件"}},[t._v("#")]),t._v(" 通知触发条件")]),t._v(" "),v("p",[t._v("用户支付成功，通过了各项支付后校验之后，会调用此接口，将支付信息同步给业务方。"),v("br")]),t._v(" "),v("blockquote",[v("p",[t._v("如未收到回调请求，请检查服务器网关是否有准入限制，如有限制参照"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_1_guide/aliyun_v2.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云安全组设置"),v("OutboundLink")],1),t._v("中的IP地址设置白名单；业务方接口的耗时要求小于2s。（超过2s会触发平台的超时重试，每2分钟/次，共计200次，回调失败订单会保持“已付款”状态，无法核销，导致订单金额无法顺利进入企业资产）。  "),v("br")])]),t._v(" "),v("h4",{attrs:{id:"业务方服务器通知参数获取"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#业务方服务器通知参数获取"}},[t._v("#")]),t._v(" 业务方服务器通知参数获取")]),t._v(" "),v("ol",[v("li",[t._v("百度收银台是用POST方式发送通知信息，参数以URL param的方式返回")])]),t._v(" "),v("p",[t._v("PHP服务推荐参数获取方式：$_POST['xxx']")]),t._v(" "),v("p",[t._v('Java服务推荐参数获取方式：@RequestParam(value="xxx")')]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[v("p",[t._v("百度收银台主动发起通知，该方式才会被启用")])]),t._v(" "),v("li",[v("p",[t._v("程序执行完后须同步返回符合要求的JSON字符串。如果商户返回给百度收银台的字符不是合法JSON或者解析出来的errno不为0，会对订单发起异常退款（所付款项及资产将全数退还给用户）")])])]),t._v(" "),v("h4",{attrs:{id:"业务方通知参数合法性验证"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#业务方通知参数合法性验证"}},[t._v("#")]),t._v(" 业务方通知参数合法性验证")]),t._v(" "),v("p",[t._v("当百度收银台通过调用接口同步支付信息给给业务方时，业务方获得这些数据时，必须进行如下处理:")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("验证签名")]),t._v(" "),v("p",[t._v("首先必需验证签名，然后验证是否是百度收银台发来的通知，请参见"),v("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/function/sign_v2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名与验签"),v("OutboundLink")],1),t._v("。")])]),t._v(" "),v("li",[v("p",[t._v("业务数据处理注意事项")]),t._v(" "),v("p",[t._v("业务方需要验证该通知数据中的tpOrderId是否为业务方系统中创建的订单号，并判断totalMoney是否确实为该订单的实际金额（即商户订单创建时的金额），上述有任何一个验证不通过，则表明本次通知是异常通知，务必忽略。在上述验证通过后业务方必须根据百度收银台不同类型的业务通知，正确的进行不同的业务处理，并且过滤重复的通知结果数据。如果商户需要对同步返回的数据做验签，必须通过服务端的签名验签代码逻辑来实现。如果商户未正确处理业务通知，存在潜在的风险，商户自行承担因此而产生的所有损失。")])])]),t._v(" "),v("h4",{attrs:{id:"demo"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[t._v("#")]),t._v(" DEMO")]),t._v(" "),v("ul",[v("li",[t._v("入参(REQUEST) DEMO：")])]),t._v(" "),v("CodeTabContent",{attrs:{name:"TEXT"}},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("https://xxx.tpbusiness.xxx/SyncPayInfo?userId=149235070&orderId=800020199&unitPrice=800&count=2&totalMoney=1600&payMoney=1200&promoMoney=100&hbMoney=100&hbBalanceMoney=100&giftCardMoney=100&dealId=7423328&payTime=1463037529&promoDetail=&payType=9101&partnerId=1000000003&status=2&tpOrderId=33330020199&returnData=&rsaSign=Gzu1RT2toJSDthcLPG1ZWROI3jzvxFtO7yCPUqMT3L7cmnARncm5IIIQ6x+7S/02zWxr5FC9945WFSurO9kepVbU7YS6Lh9SEVQhvTO0YKG7TlLFTpH3Ik7JeHQalAKXYe/jNREDpHmTF9Jrq/wABeZGYXJn1M75A37h9zUt+kw=\n")])])]),v("br"),t._v(" "),v("ul",[v("li",[t._v("返回(RESPONSE) DEMO:")])]),t._v(" "),v("CodeTabContent",{attrs:{name:"TEXT"}},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('{"errno":0,"msg":"success","data":{"isConsumed":2}}\n')])])]),v("p",[t._v("如处理支付回调的过程中开发者端参数异常、其他异常，返回以下参数进行异常退款:")]),t._v(" "),v("CodeTabContent",{attrs:{name:"TEXT"}},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('{"errno": 0,"msg": "success","data": {"isErrorOrder": 1,"isConsumed": 2}\n')])])]),v("br"),t._v(" "),v("p",[t._v("小程序场景isConsumed返回值一定要为2，（字段不设置为2订单不会变更为“已消费”）不按照要求值返回参数，用户已付款金额不能顺利进入企业余额。")])],1)}),[],!1,null,null,null);_.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{299:function(t,_,v){"use strict";v.r(_);var r=v(28),a=Object(r.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h3",{attrs:{id:"使用场景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[t._v("#")]),t._v(" 使用场景")]),t._v(" "),v("p",[t._v("当用户的某个订单申请了退款后，百度收银台会主动调用业务方的退款审核地址（开发者平台注册的退款审核地址）询问订单是否可退。")]),t._v(" "),v("h3",{attrs:{id:"接口注意事项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#接口注意事项"}},[t._v("#")]),t._v(" 接口注意事项")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("幂等性：业务方接口需要具备幂等性"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_2_base/anchor/term.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("平台技术术语---幂等性"),v("OutboundLink")],1),t._v("；")])]),t._v(" "),v("li",[v("p",[t._v("超时时间：业务方接口的耗时要求小于2s（超过2s会触发平台的超时重试，重试间隔：2min/4min/10min/30min/1h...）；")])]),t._v(" "),v("li",[v("p",[t._v("返回值判断：errno为0表示业务方已经成功收到该订单的退款审核信息，errno不为0将认为是请求业务方退款审核接口失败，会发起重试（不限次数，重试间隔：2min/4min/10min/30min/1h...）。")])]),t._v(" "),v("li",[v("p",[t._v("异常退款：由于支付回调不成功导致的异常退款也会请求业务方退款审核。")])])]),t._v(" "),v("h4",{attrs:{id:"请求参数说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#请求参数说明"}},[t._v("#")]),t._v(" 请求参数说明")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("参数名称")]),t._v(" "),v("th",[t._v("类型（长度范围）")]),t._v(" "),v("th",[t._v("参数说明")]),t._v(" "),v("th",[t._v("是否必需")]),t._v(" "),v("th",[t._v("样例")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("orderId")]),t._v(" "),v("td",[t._v("订单ID")]),t._v(" "),v("td",[t._v("Long")]),t._v(" "),v("td",[t._v("百度平台订单ID")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("1068881223")])]),t._v(" "),v("tr",[v("td",[t._v("userId")]),t._v(" "),v("td",[t._v("用户ID")]),t._v(" "),v("td",[t._v("Long")]),t._v(" "),v("td",[t._v("百度用户ID")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("149235070")])]),t._v(" "),v("tr",[v("td",[t._v("tpOrderId")]),t._v(" "),v("td",[t._v("业务方订单ID")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("业务方订单ID")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("11119800")])]),t._v(" "),v("tr",[v("td",[t._v("refundBatchId")]),t._v(" "),v("td",[t._v("退款批次号")]),t._v(" "),v("td",[t._v("String")]),t._v(" "),v("td",[t._v("百度平台退款批次号【"),v("a",{attrs:{href:"https://dianshang.baidu.com/platform/doclist/index.html#!/doc/nuomiplus_2_base/anchor/term.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("幂等性"),v("OutboundLink")],1),t._v("标识参数】(用于重入判断)")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("149235070")])]),t._v(" "),v("tr",[v("td",[t._v("applyRefundMoney")]),t._v(" "),v("td",[t._v("退款金额")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("退款金额，单位：分")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("100")])]),t._v(" "),v("tr",[v("td",[t._v("rsaSign")]),t._v(" "),v("td",[t._v("参数签名")]),t._v(" "),v("td",[t._v("String")]),t._v(" "),v("td",[t._v("平台生成的sign")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("全部参数参与签名，详见"),v("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/function/sign_v2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名与验签"),v("OutboundLink")],1)])])])])]),t._v(" "),v("br"),t._v(" "),v("blockquote",[v("p",[t._v("这里对全部参数签名是对平台的所有POST参数进行签名，如果商户URL里包含GET类型参数，不会参与签名。验签需要使用正确格式的平台公钥，可以在服务详情中查询，详见"),v("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/function/sign_v2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名与验签"),v("OutboundLink")],1),t._v("第8项内容。")])]),t._v(" "),v("h4",{attrs:{id:"返回参数说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#返回参数说明"}},[t._v("#")]),t._v(" 返回参数说明")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("名称")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("是否必须")]),t._v(" "),v("th",[t._v("示例值")]),t._v(" "),v("th",[t._v("描述")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("errno")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("0")]),t._v(" "),v("td",[t._v("返回码")])]),t._v(" "),v("tr",[v("td",[t._v("msg")]),t._v(" "),v("td",[t._v("String")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("success")]),t._v(" "),v("td",[t._v("返回信息")])]),t._v(" "),v("tr",[v("td",[t._v("data")]),t._v(" "),v("td",[t._v("Object")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v('{"auditStatus":1,"calculateRes":{"refundPayMoney":100}}')]),t._v(" "),v("td",[t._v("返回数据")])])])])]),t._v(" "),v("br"),t._v(" "),v("p",[t._v("data字段为json格式，参数如下：")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("名称")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("是否必须")]),t._v(" "),v("th",[t._v("示例值")]),t._v(" "),v("th",[t._v("描述")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("auditStatus")]),t._v(" "),v("td",[t._v("Integer")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v("0")]),t._v(" "),v("td",[t._v("退款审核状态")])]),t._v(" "),v("tr",[v("td",[t._v("calculateRes")]),t._v(" "),v("td",[t._v("Object")]),t._v(" "),v("td",[t._v("是")]),t._v(" "),v("td",[t._v('{"refundPayMoney":100}')]),t._v(" "),v("td",[t._v("全额退和部分退均要填写订单实际退款金额，单位：分。不论审核成功还是失败都需要填写本字段。")])])])])]),t._v(" "),v("blockquote",[v("p",[t._v("refundPayMoney的值是以分为单位的整数。"),v("br"),t._v(" "),v("br")])]),t._v(" "),v("p",[t._v("auditStatus枚举值说明如下：")]),t._v(" "),v("div",{staticClass:"table-wrap"},[v("table",[v("thead",[v("tr",[v("th",[t._v("auditStatus枚举值")]),t._v(" "),v("th",[t._v("枚举说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("审核通过可退款")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("审核不通过，不能退款")])]),t._v(" "),v("tr",[v("td",[t._v("3")]),t._v(" "),v("td",[t._v("审核结果不确定，待重试")])])])])]),t._v(" "),v("br"),t._v(" "),v("p",[v("strong",[t._v("auditStatus重要性：")]),t._v(" 为必传参数（不传会认为接口返回出错），用来标识第三方的退款审核结果，平台根据审核结果执行退款或置为不可退款，若auditStatus=3，百度收银台会视为审核结果不确定，会继续重试（重试频率：每5min一次），目前重试次数&重试期限不做限制（直到业务方返回审核通过或不通过等审核终态才结束重试）。")]),t._v(" "),v("blockquote",[v("p",[t._v("业务方返回auditStatus=3，退款审核结果不确定，收银台不会给用户退款，可能会影响用户退款体验。")])]),t._v(" "),v("h3",{attrs:{id:"通知触发条件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#通知触发条件"}},[t._v("#")]),t._v(" 通知触发条件")]),t._v(" "),v("p",[t._v("当订单发起退款时，经平台初步校验认为可以退款的，会通过此接口向业务方请求退款审核。")]),t._v(" "),v("h3",{attrs:{id:"业务方服务器参数获取"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#业务方服务器参数获取"}},[t._v("#")]),t._v(" 业务方服务器参数获取")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("百度收银台是用POST方式发送通知信息，因此该页面中获取参数的方式，如：request.Form(“orderId”)、$_POST[‘orderId’]；")])]),t._v(" "),v("li",[v("p",[t._v("百度收银台主动发起通知，该方式才会被启用；")])]),t._v(" "),v("li",[v("p",[t._v("服务器间的交互，不像页面跳转同步通知可以在页面上显示出来，这种交互方式是不可见的；")])]),t._v(" "),v("li",[v("p",[t._v("程序执行完后必须打印输出符合要求的JSON字符串。如果商户反馈给百度收银台的字符不是合法json或者解析出来的errno不为0会对此次请求发起重试；")])]),t._v(" "),v("li",[v("p",[t._v("cookies、session等在此页面会失效，即无法获取这些数据；")])]),t._v(" "),v("li",[v("p",[t._v("该方式的调试与运行必须在服务器上，即互联网上能访问。")])])]),t._v(" "),v("h3",{attrs:{id:"业务方通知参数合法性验证"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#业务方通知参数合法性验证"}},[t._v("#")]),t._v(" 业务方通知参数合法性验证")]),t._v(" "),v("p",[t._v("当百度收银台通过调用接口请求业务方订单退款审核时，业务方获得这些数据后，必须进行如下处理:")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("验证签名")]),t._v(" "),v("p",[t._v("首先必需验证签名，然后验证是否是平台发来的通知，请参见"),v("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/function/sign_v2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名与验签"),v("OutboundLink")],1),t._v("。")])]),t._v(" "),v("li",[v("p",[t._v("业务数据处理注意事项")]),t._v(" "),v("p",[t._v("业务方需要验证该通知数据中的orderId是否为业务方系统中创建的订单号，若非业务方订单，则表明本次通知是异常通知，务必忽略。在上述验证通过后业务方请审核判断该订单是否可以退款，将审核结果返回（若业务方返回可退款，平台会执行退款任务，退款成功后该笔订单不参与业务方的核销结算）。如果商户未正确处理业务通知，存在潜在的风险，商户自行承担因此而产生的所有损失。")])])]),t._v(" "),v("h3",{attrs:{id:"demo"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[t._v("#")]),t._v(" DEMO")]),t._v(" "),v("ul",[v("li",[t._v("入参(REQUEST) DEMO：")])]),t._v(" "),v("CodeTabContent",{attrs:{name:"TEXT"}},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("https://xxx.tpbusiness.xxx/refundAudit?orderId=800020199&refundBatchId=100003588&rsaSign=Gzu1RT2toJSDthcLPG1ZWROI3jzvxFtO7yCPUqMT3L7cmnARncm5IIIQ6x+7S/02zWxr5FC9945WFSurO9kepVbU7YS6Lh9SEVQhvTO0YKG7TlLFTpH3Ik7JeHQalAKXYe/jNREDpHmTF9Jrq/wABeZGYXJn1M75A37h9zUt+kw=\n")])])]),v("ul",[v("li",[t._v("返回(RESPONSE) DEMO:")])]),t._v(" "),v("CodeTabContent",{attrs:{name:"TEXT"}},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v('{"errno":0,"msg":"success","data":{"auditStatus":1, "calculateRes":{"refundPayMoney":100}}}\n')])])]),v("br"),t._v(" "),v("blockquote",[v("p",[t._v("refundPayMoney的值是以分为单位的整数，如不严格按照文档提示操作，会导致退款审核失败。"),v("br"),t._v(" "),v("br")])])],1)}),[],!1,null,null,null);_.default=a.exports}}]);